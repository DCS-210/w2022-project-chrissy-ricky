---
title: "Covid-19, Global Pandemic, and Data Science"
subtitle:
author: "Team Chrissy & Ricky <br> Chrissy Aman and Ricky Sun"
institute: "Bates College"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    css: xaringan-themer2.css
    lib_dir: libs
    nature:
      ratio: "16:9"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false

#xaringan::inf_mr()
#accessible colors: scale_color_viridis_d() 
---

```{r load-packages, include = FALSE}
# Add any additional packages you need to this chunk
library(tidyverse)
library(tidymodels)
library(reshape2)
library(palmerpenguins)
library(knitr)
library(tmap)
library(tmaptools)
library(sf)
library(leaflet)
library(xaringanthemer)
library(rgdal)
library(plm)       # Panel data analysis library
library(car)       # Companion to applied regression 
library(gplots)    # Various programing tools for plotting data
library(tseries)   # For timeseries analysis
library(lmtest)    # For hetoroskedasticity analysis
library(dygraphs)
library(xts) # To make the convertion data-frame / xts format
```

```{r setup, include=FALSE}
# For better figure resolution
knitr::opts_chunk$set(fig.retina = 3, dpi = 300, fig.width = 6, fig.asp = 0.618, out.width = "80%")
```

```{r load-data, include=FALSE}
# Load your data here
covid_data <- readr::read_csv(file = "../data/owid-covid-data.csv")
covid_data <- covid_data %>%
  mutate(year = format(date, format="%Y")) %>%
  mutate(month = format(date, format="%M")) %>%
  mutate(day = format(date, format="%D")) 
```

```{r title-page-pic, include=FALSE}
style_xaringan(
  title_slide_background_image = "img/covid.jpg"
)
```

## Outline 

<style type="text/css">
.remark-slide-content {
    font-size: 30px;
    padding: 1em 4em 1em 4em;
}
</style>

- Introduction

- Literature Review

- Our Data  

- Methods & Data Analyses

- Results

- Limitations and Potential Future Studies

---


class: inverse, center, middle

background-image: url("images/cool.png")

# Introduction

---

# Introduction 

COVID-19, also known as Coronavirus disease 2019 is a contagious disease caused by a virus, the severe acute respiratory syndrome coronavirus 2 (SARS-CoV-2)

Up until yesterday, there are over 497,057,239 infections and 6,179,104 deaths since the beginning of the pandemic

Although no one can predict a pandemic like this, with the help of data, we might be able to use available data to, for example, evaluate risks, so that the virus and mutations can be better managed or even contained in earlier stages

---

## Research Question

- In our research, we are trying to use Covid-19 related data, together with other relevant
data to find potential predictors for Covid-19 cases, deaths, or vaccination rates. 

? Do vaccinations effectively mitigate the death rate 

? Can we implement machine learning algorithm to predict Covid-19

? Are higher percentage of older people predicts higher death rate

? What about other variables in predicting Covid-19

---

class: inverse, middle, center

# Literature Review

---

# [1a] Covid-19 severity

- The unpredictability of the progression of coronavirus disease 2019 (COVID-19) may be attributed to the low precision of the tools used to predict the prognosis of this disease, especially when the virus is mutating in a fast speed from alpha, to Omicron, and there are more recent variants too.

- With the help of models proposed (using clinical data) by those paper, we may be better at prognosis of Covid-19 cases severity. This can also be used in decision-making related to the care of patients infected with COVID-19.

]
.footnote[.small[
[1] 
[2]
[3]
]

---

# [1b] vitamin D and covid-19

Several studies suggest an association between serum 25-hydroxyvitamin D (25OHD) and the likelihood of suffering severe symptoms of covid-19. The data supports a significant effect of vitamin D in preventing and mitigating respiratory tract infections have emerged. Severe deficiency, deficiency and insufficiency of vitamin D were all associated with ICU admission In this study of almost 1.5 million individuals. 

]
.footnote[.small[
[1] 
[2]
[3]
]

---

# [2] Covid-19 and weather

- Akin to respiratory tract infection diseases, climatic conditions may significantly influence the COVID-19 pandemic, significant efforts have been made to explore the relationship between climatic condition and growth in number of COVID-19 cases. 

- From those studies, it seems that there are significant Interactions of temperature and relative humidity for growth of COVID-19 cases and death rates. Air pollution may be another factor that predict covid-19 deaths. Those evidence are collected from various of countries.

]
.footnote[.small[
[1] Khan, A. R., Abedin, S., &amp; Khan, S. (2022). Interaction of temperature and relative        humidity for growth of COVID-19 cases and death rates. Environmental Research Letters   
[2] Azuma, K., Kagi, N., Kim, H., &amp; Hayashi, M. (2020). Impact of climate and ambient air       pollution on the epidemic growth during COVID-19 outbreak in Japan                 
[3] Aboubakri, O., Ballester, J., Shoraka, H. R., Karamoozian, A., &amp; Golchini, E. (2022). Ambient temperature and covid-19 transmission: An evidence from a region of Iran based on weather station and satellite data
]
---
# [3] Covid-19 and social media

- Social media data (such as twits or social media indexes) from, for example, google search, twitter, facebook and other social media platform, may also be used to develop models and as early warning signals of COVID-19 outbreaks. Social media data can also presents with people's perception of risks and general mental states of a region.

]
.footnote[.small[
[1] 
[2]
[3]
]

---

# [4] COVID-19 and impacts

- Covid-19 also has had great impacts in our daily lives (racial issues, job markets, also economic activities, and so on)

### It is found that an increase in vaccination per capita is associated with a significant increase in economic activity. 

### It is also found evidence for nonlinear effects of vaccines: marginal economic benefits when vaccination rates are higher. 

### Country-specific conditions play an important role, with lower economic gains if strict containment measures are in place or if the country is experiencing a severe outbreak.

]
.footnote[.small[
[1] 
[2]
[3]
]

---

# [5] Covid-19 and machine learning

- Developing accurate forecasting tools will help in our fight against the pandemic. Prediction models that combine several features to estimate the risk of infection have been developed. 

- These aim to assist medical staff worldwide in triaging patients, especially in the context of limited healthcare resources.

]
.footnote[.small[
[1] 
[2]
[3]
]

---

class: inverse, middle, center

# Our Data

---

## Our Data - details

Our dataset is coming from "Our World in Data" Covid-19 public data, together with data from JHU, WHO, CDC and World Bank. The data covers a wide range:

- Basic Covid-19 data (cases, deaths)
- Hospital & ICU (ICU beds, ICU patients)
- Policy responses (stringency_index)
- Reproduction rate
- Tests & positivity
- Vaccinations
- Others (populations, life_expectancy, GDP per catpita and so on)

---

class: inverse, middle, center

# Methods & Data Analyses

---

# Methods & Data Analyses - details

We have three major parts of analyses:
1. preliminary exploration like summary statistics, scatter plots, correlations, maps

2. Regression analyses, ranging from OLS, Diff in Diff, regression continuity

3. Advanced models and machine learning algorithnms

---

class: inverse, middle, center

# Results & Implications 

---

# [1a] summary statistics

---

# [1a] summary statistics
Development (HDI)

.pull-left[
- Some text
- goes here
]
.pull-right[
```{r development, echo = FALSE}
development <- covid_data %>%
  filter(date == "2022-02-20") %>%
  filter(is.na(continent) == FALSE) %>%
  select(location, human_development_index) %>%
  arrange(desc(human_development_index)) %>%
  top_n(10)

development
```
]

---

```{r HDI-map, echo = FALSE}
HDI <- covid_data %>%
  filter(date == "2022-02-20") %>%
  filter(is.na(continent) == FALSE) %>%
  select(iso_code, location, date, human_development_index) %>%
  na.omit()

worldshape <- readOGR( 
  dsn= ("/cloud/project/data/world_shape_file/"), 
  layer="TM_WORLD_BORDERS-0.3",
  verbose=FALSE)

worldshape2 <- st_read("/cloud/project/data/world_shape_file/TM_WORLD_BORDERS-0.3.shp")

hdi_map <- HDI %>% 
  left_join(worldshape2, by = c("location" = "NAME")) %>%
  st_as_sf()

pal2 <- colorNumeric(palette = "RdYlGn", domain = hdi_map$human_development_index)
labels <- sprintf("<strong>%s</strong><br/>%s ", hdi_map$location, hdi_map$human_development_index) %>%
  lapply(htmltools::HTML)

h_map <- leaflet(data = hdi_map) %>% 
  addTiles()  %>% 
  setView(lat=10, lng=0 , zoom=1.5) %>%
  addPolygons(fillColor = ~pal2(hdi_map$human_development_index),
                                 fillOpacity = 1, 
                                 color = "white",
                                 opacity = 0.7,
                                 weight = 1,
                                 label = labels) %>%
  leaflet::addLegend("topright", pal = pal2, values = ~hdi_map$human_development_index,
    title = "Human Development Index",
    opacity = 1)

h_map
```

---

# Results & Implications [1b: preliminary analyses - correlation and heat map]

```{r correlation_heatmap, echo = FALSE}
covid_heat <- covid_data %>%
  filter(date == "2022-02-20") %>%
  filter(is.na(continent) == FALSE) %>%
  mutate(smoker = female_smokers + male_smokers) %>%
  mutate(vaccination = people_fully_vaccinated/population) %>%
  mutate(boosters = total_boosters/population) %>%
  select(vaccination, total_cases_per_million, total_deaths_per_million, boosters, population_density, stringency_index, aged_70_older, gdp_per_capita, hospital_beds_per_thousand,smoker, human_development_index) %>%
  na.omit()
  
cormat <- round(cor(covid_heat),2)

melted_cormat <- melt(cormat)

ggplot(data = melted_cormat, aes(x=Var1, y=Var2, fill=value)) + 
  geom_tile() +
  geom_tile(color = "white") +
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
                       midpoint = 0, limit = c(-1,1), space = "Lab",
                       name="Pearson\nCorrelation") +
  theme_minimal() + 
  theme(axis.text.x = element_text(angle = 45, vjust = 1, 
                                   size = 10, hjust = 1))+
  coord_fixed()
```

---

# Results & Implications [1c: preliminary analyses - maps]

Include dynamic maps for vaccination


Alt (alternative) text
1. chart type
2. of type data (x and y, color)
3. reason for including chart

```{r, echo = FALSE, fig.alt = "scatterplot of flipper length by bill length of 3 penguin species, where we show penguins with bigger flippers have bigger bills"}

```

```{r shapefile}
worldshapefile <- "data/world_shape_file/TM_WORLD_BORDERS-0.3.shp"
shape <- st_read(dsn = "../data/world_shape_file/TM_WORLD_BORDERS-0.3.shp")
```

---

# Results & Implications [1d: preliminary analyses - scatter plots and other ggplots]

```{r vaccination-HDI, fig.alt = "scatterplot of flipper length by bill length of 3 penguin species, where we show penguins with bigger flippers have bigger bills"}
covid_data %>%
  filter(date == "2022-02-20") %>%
  filter(is.na(continent) == FALSE) %>%
  mutate(smoker = female_smokers + male_smokers) %>%
  mutate(vaccination_rate = people_fully_vaccinated/population) %>%  
  mutate(booster = total_boosters/population) %>%
  ggplot(mapping = aes(x = vaccination_rate, 
                       y = human_development_index)) +
  geom_point(size = 2, mapping = aes()) +
  labs(title = "vaccination rate vs. human development index", 
       subtitle = "xx",
       x = "vaccination rate",
       y = "human development index") +
  scale_color_viridis_d() +
  geom_smooth(color = "blue") 
```

---

# Results & Implications [1d: preliminary analyses - scatter plots and other ggplots]
```{r cases-diabetes}
covid_data %>%
  filter(date == "2022-02-20") %>%
  filter(is.na(continent) == FALSE) %>%
  mutate(smoker = female_smokers + male_smokers) %>%
  mutate(vaccination_rate = people_fully_vaccinated/population) %>%  
  mutate(death = total_deaths/population) %>%  
  mutate(booster = total_boosters/population) %>%
  ggplot(mapping = aes(x = vaccination_rate, 
                       y = death)) +
  geom_point(size = 1, mapping = aes()) +
  labs(title = "percentage death of population vs. diabetes prevalence", 
       subtitle = "xx",
       x = "percentage death of population",
       y = "diabetes prevalence") +
  scale_color_viridis_d() +
  geom_smooth(color = "blue") 
```

---

# Results & Implications [1e: time series analyses]

---
```{r time-table, echo = FALSE}
covid_time <- covid_data %>%
  select(location, date, total_cases) %>%
  filter(location == c("China", "Japan", "India", "Brazil", "France", "Germany", "Italy", "Mexico", "Russia", "United Kindom", "United States"))

covid_time_wide <- pivot_wider(data = covid_time,
                                names_from = location,
                                values_from = total_cases)

don = xts(x = covid_time_wide[,-1], order.by = covid_time_wide$date)

p <- dygraph(don)
p


```

---

```{r}

```


---
# Results & Implications [1e: time series analyses]





---

# Results & Implications - [2a: regression analyses - simple linear regression]

```{r linear-model-1, echo = FALSE}
covid_total <- covid_data %>%
  filter(date == "2022-02-20")

covid_country <- covid_total %>%
  filter(is.na(continent) == FALSE) %>%
  mutate(vaccination = people_fully_vaccinated/population) %>%
  mutate(booster = total_boosters/population)

covid_other <- covid_total %>%
  filter(is.na(continent) == TRUE)

reg1 <- linear_reg() %>%
  set_engine("lm") %>%
  fit(total_deaths_per_million ~ human_development_index + vaccination, data = covid_country) 
reg1
glance(reg1)$r.squared
glance(reg1)$adj.r.squared
```

```{r linear-model-2, echo = FALSE}
linear_reg() %>%
  set_engine("lm") %>%
  fit(total_deaths_per_million ~ human_development_index + vaccination + booster + stringency_index, data = covid_country) %>%
  tidy()
```

---

# Results & Implications - [2a: regression analyses - simple linear regression]

```{r training-test}

```


---

# Results & Implications - [2b: regression analyses - other]

1. Fixed effect

2. Difference in Difference

3. Regression Discontinuity

```{r make-dummy2}
#covid_data2 <- covid_data1 %>%
# select(vaccine_introduced, total_vaccinations, date, first_vaccination, interaction_term, #location, new_cases_per_million, weekly_hosp_admissions_per_million)
```
```{r make-dataset2}
#covid_data3 <- covid_data1 %>%
#  select(date, location, new_cases_per_million, weekly_hosp_admissions_per_million, people_fully_vaccinated_per_hundred,  new_deaths_per_million) %>% na.omit(people_fully_vaccinated_per_hundred, population_density, total_cases_per_million)
```

```{r make-covid-data-10}
#covid_data7 <- covid_data3 %>%
#  filter(location == "United States" | location == "United Kingdom" | location == "Canada" | location == "Belgium" | location == "Israel")
```

``` {r make-feregression}
#fixed.dum <-lm(weekly_hosp_admissions_per_million ~ people_fully_vaccinated_per_hundred + factor(location) - 1, data = covid_data7)
#summary(fixed.dum)

#yhat <- fixed.dum$fitted
#scatterplot(yhat ~ covid_data7$people_fully_vaccinated_per_hundred | covid_data7$location,  xlab ="people fully vaccinated per hundred", ylab ="covid cases", boxplots = FALSE, smooth = FALSE)
#abline(lm(covid_data7$weekly_hosp_admissions_per_million~covid_data7$people_fully_vaccinated_per_hundred),lwd=5, col="red")
```

---

# Results & Implications - [3: machine learnng]

1. linear regression


2. logistic regression


3. KNN (clusters) https://github.com/allisonhorst/stats-illustrations/



---

class: inverse, middle, center

# Limitations and Potential Future Studies

---

# Limitations - details


---

# Future Studies

Future studies

---

# References

[1] Want to find out more about `xaringan`? See https://slides.yihui.name/xaringan/#1.

[2] You are welcomed to use the default styling of the slides. In fact, that's what I expect majority of you will do. You will differentiate yourself with the content of your presentation.

[3]

[4]

---
