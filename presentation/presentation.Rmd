---
title: "Covid-19, Global Pandemic, and Data Science"
subtitle:
author: "Team Chrissy & Ricky <br> Chrissy Aman and Ricky Sun"
institute: "Bates College"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    css: xaringan-themer.css
    lib_dir: libs
    nature:
      ratio: "16:9"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false

#xaringan::inf_mr()
#accessible colors: scale_color_viridis_d() 
---

```{r load-packages, include = FALSE}
# Add any additional packages you need to this chunk
library(tidyverse)
library(tidymodels)
library(reshape2)
library(palmerpenguins)
library(knitr)
library(tmap)
library(tmaptools)
library(sf)
library(leaflet)
library(xaringanthemer)
```

```{r setup, include=FALSE}
# For better figure resolution
knitr::opts_chunk$set(fig.retina = 3, dpi = 300, fig.width = 6, fig.asp = 0.618, out.width = "80%")
```

```{r load-data, include=FALSE}
# Load your data here
covid_data <- readr::read_csv(file = "../data/owid-covid-data.csv")
```

```{r title-page-pic, include=FALSE}
style_xaringan(
  title_slide_background_image = "img/covid.jpg"
)
```

## Outline 

<style type="text/css">
.remark-slide-content {
    font-size: 30px;
    padding: 1em 4em 1em 4em;
}
</style>

- Introduction

- Literature Review

- Our Data  

- Methods & Data Analyses

- Results

- Limitations and Potential Future Studies

---


class: inverse, center, middle

background-image: url("images/cool.png")

# Introduction

How to add background pic 
---

# Introduction 

COVID-19, also known as Coronavirus disease 2019 is a contagious disease caused by a virus, the severe acute respiratory syndrome coronavirus 2 (SARS-CoV-2)

Up until yesterday, there are over xxx infections and xxx deaths since the beginning of the pandemic

Although no one can predict a pandemic like this, with the help of data, we might be able to use available data to, for example, evaluate risks, so that the virus can be better managed or even contained in earlier stages. 

---

## Research Question

- In our research, we are trying to use Covid-19 related data, together with other relevant
data to find potential predictors for Covid-19 cases, deaths, or vaccination rates. 


? Do vaccinations effectively mitigate the death rate 

? Can we implement machine learning algorithm to predict Covid-19

? Are higher percentage of older people predicts higher death rate

? What about other variables in predicting Covid-19

---

class: inverse, middle, center

# Literature Review

```{r section-title-pic, include=FALSE}
style_xaringan(
  title_slide_background_image = "img/covid.jpg"
)
```

---

class: my-one-page-font

# [1] Covid-19 severity

- The unpredictability of the progression of coronavirus disease 2019 (COVID-19) may be attributed to the low precision of the tools used to predict the prognosis of this disease, especially when the virus is mutating in a fast speed from alpha, to Omicron, and there are more recent variants too. 

- With the help of models proposed (using clinical data) by those paper, we may be better at prognosis of Covid-19 cases severity. This can also be used in decision-making related to the care of patients infected with COVID-19.

.my-one-page-font {
  font-size: 20px;
}

]
.footnote[
vv
]
---

# [2] Covid-19 and weather

- Akin to respiratory tract infection diseases, climatic conditions may significantly influence the COVID-19 pandemic Since the beginning of the COVID-19 pandemic, significant efforts have been made to explore the relationship between climatic condition and growth in number of COVID-19 cases. 

- From those studies, it seems that there are significant Interactions of temperature and relative humidity for growth of COVID-19 cases and death rates. Air pollution may be another factor that predict covid-19 deaths. Those evidence are collected from various of countries.

---
# [3] Covid-19 and social media

- Social media data (such as twits or social media indexes) from, for example, google search, twitter, facebook and other social media platform, may also be used to develop models and as early warning signals of COVID-19 outbreaks. Social media data can also presents with people's perception of risks and general mental states of a region.

---

# [4] COVID-19 and impacts

- Covid-19 also has had great impacts in our daily lives (racial issues, job markets, also economic activities, and so on)

### It is found that an increase in vaccination per capita is associated with a significant increase in economic activity. 

### It is also found evidence for nonlinear effects of vaccines: marginal economic benefits when vaccination rates are higher. 

### Country-specific conditions play an important role, with lower economic gains if strict containment measures are in place or if the country is experiencing a severe outbreak.

---

# [5] Covid-19 and machine learning

- Developing accurate forecasting tools will help in our fight against the pandemic. Prediction models that combine several features to estimate the risk of infection have been developed. 

- These aim to assist medical staff worldwide in triaging patients, especially in the context of limited healthcare resources.

# [6] vitamin D and covid-19
https://www.frontiersin.org/articles/10.3389/fpubh.2021.736665/full

Several studies suggest an association between serum 25-hydroxyvitamin D (25OHD) and the likelihood of suffering severe symptoms of covid-19. The data supports a significant effect of vitamin D in preventing and mitigating respiratory tract infections have emerged. Severe deficiency, deficiency and insufficiency of vitamin D were all associated with ICU admission In this study of almost 1.5 million individuals. 
---

# Literature Review - [6?]

---

class: inverse, middle, center

# Our Data

---

## Our Data - details

Our dataset is coming from "Our World in Data" Covid-19 public data, together with data from JHU, WHO, CDC and World Bank. The data covers a wide range:

- Basic Covid-19 data (cases, deaths)
- Hospital & ICU (ICU beds, ICU patients)
- Policy responses (stringency_index)
- Reproduction rate
- Tests & positivity
- Vaccinations
- Others (populations, life_expectancy, GDP per catpita and so on)

---

class: inverse, middle, center

# Methods & Data Analyses

---

# Methods & Data Analyses - details

We have three major parts of analyses:
1. preliminary exploration like summary statistics, scatter plots, correlations, maps

2. Regression analyses, ranging from OLS, Diff in Diff, regression continuity

3. Advanced models and machine learning algorithnms

---

class: inverse, middle, center

# Results & Implications 

---

# [1a] summary statistics

---

# [1a] summary statistics
Development (HDI)
```{r development, echo = FALSE}
development <- covid_data %>%
  filter(date == "2022-02-20") %>%
  filter(is.na(continent) == FALSE) %>%
  select(location, human_development_index) %>%
  arrange(desc(human_development_index)) %>%
  top_n(10)

development
```
---

```{r HDI-map, echo = FALSE}
HDI <- covid_data %>%
  filter(date == "2022-02-20") %>%
  filter(is.na(continent) == FALSE) %>%
  select(iso_code, location, date, human_development_index) %>%
  na.omit()

world_spdf <- readOGR( 
  dsn= ("/cloud/project/data/world_shape_file/"), 
  layer="TM_WORLD_BORDERS-0.3",
  verbose=FALSE)

world_spdf2 <- st_read("/cloud/project/data/world_shape_file/TM_WORLD_BORDERS-0.3.shp")

hdi_map <- HDI %>% 
  left_join(world_spdf2, by = c("location" = "NAME")) %>%
  st_as_sf()

pal2 <- colorNumeric(palette = "RdYlGn", domain = hdi_map$human_development_index)
labels <- sprintf("<strong>%s</strong><br/>%s ", hdi_map$location, hdi_map$human_development_index) %>%
  lapply(htmltools::HTML)

h_map <- leaflet(data = hdi_map) %>% 
  addTiles()  %>% 
  setView( lat=10, lng=0 , zoom=1) %>%
  addPolygons(fillColor = ~pal2(hdi_map$human_development_index),
                                 fillOpacity = 1, 
                                 color = "white",
                                 opacity = 0.7,
                                 weight = 1,
                                 label = labels) %>%
  addLegend("bottomleft", pal = pal2, values = ~hdi_map$human_development_index,
    title = "Human Development Index",
    opacity = 1)

h_map
```

---

# Results & Implications [1b: preliminary analyses - correlation and heat map]

```{r correlation_heatmap, echo = FALSE}
covid_heat <- covid_data %>%
  filter(date == "2022-02-20") %>%
  filter(is.na(continent) == FALSE) %>%
  mutate(smoker = female_smokers + male_smokers) %>%
  select(total_vaccinations, total_cases, total_deaths, total_boosters, population_density, extreme_poverty, aged_70_older, cardiovasc_death_rate, smoker, human_development_index) %>%
  na.omit()
  
cormat <- round(cor(covid_heat),2)

melted_cormat <- melt(cormat)

ggplot(data = melted_cormat, aes(x=Var1, y=Var2, fill=value)) + 
  geom_tile() +
  geom_tile(color = "white") +
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
                       midpoint = 0, limit = c(-1,1), space = "Lab",
                       name="Pearson\nCorrelation") +
  theme_minimal() + 
  theme(axis.text.x = element_text(angle = 45, vjust = 1, 
                                   size = 10, hjust = 1))+
  coord_fixed()
```

---

# Results & Implications [1c: preliminary analyses - maps]

Include dynamic maps for vaccination



Alt (alternative) text
1. chart type
2. of type data (x and y, color)
3. reason for including chart

```{r, echo = FALSE, fig.alt = "scatterplot of flipper length by bill length of 3 penguin species, where we show penguins with bigger flippers have bigger bills"}

```

```{r shapefile}
worldshapefile <- "data/world_shape_file/TM_WORLD_BORDERS-0.3.shp"
shape <- st_read(dsn = "../data/world_shape_file/TM_WORLD_BORDERS-0.3.shp")
```

---

# Results & Implications [1d: preliminary analyses - scatter plots and other ggplots]

```{r vaccination-HDI}
covid_data %>%
  filter(date == "2022-02-20") %>%
  filter(is.na(continent) == FALSE) %>%
  mutate(smoker = female_smokers + male_smokers) %>%
  mutate(vaccination_rate = people_fully_vaccinated/population) %>%  
  mutate(booster = total_boosters/population) %>%
  ggplot(mapping = aes(x = vaccination_rate, 
                       y = human_development_index)) +
  geom_point(size = 2, mapping = aes()) +
  labs(title = "vaccination rate vs. human development index", 
       subtitle = "xx",
       x = "vaccination rate",
       y = "human development index") +
  scale_color_viridis_d() +
  geom_smooth(color = "blue") 
```

---

# Results & Implications [1d: preliminary analyses - scatter plots and other ggplots]
```{r cases-diabetes}
covid_data %>%
  filter(date == "2022-02-20") %>%
  filter(is.na(continent) == FALSE) %>%
  mutate(smoker = female_smokers + male_smokers) %>%
  mutate(vaccination_rate = people_fully_vaccinated/population) %>%  
  mutate(death = total_deaths/population) %>%  
  mutate(booster = total_boosters/population) %>%
  ggplot(mapping = aes(x = vaccination_rate, 
                       y = death)) +
  geom_point(size = 1, mapping = aes()) +
  labs(title = "percentage death of population vs. diabetes prevalence", 
       subtitle = "xx",
       x = "percentage death of population",
       y = "diabetes prevalence") +
  scale_color_viridis_d() +
  geom_smooth(color = "blue") 
```

---

# Results & Implications [1e: time series analyses]

---
```{r}
# Libraries
library(dygraphs)
library(xts) # To make the convertion data-frame / xts format

# Format 3: Several variables for each date
covid_time <- covid_data %>%
  select(location, date, total_cases) %>%
  filter(location == c("China", "Japan", "India", "Brazil", "France", "Germany", "Italy", "Mexico", "Russia", "United Kindom", "United States"))

```

```{r}
covid_time_wide <- reshape(data=covid_time,idvar="location",
                          v.names = "total_cases",
                          timevar = "date",
                          direction="wide")
```


```{r}
data <- data.frame(
  time=seq(date), 
  value1=
  value2=
)

# Then you can create the xts format:
don=xts( x=data[,-1], order.by=data$time)

# Chart
p <- dygraph(don)
p

```


---

# Results & Implications - [2a: regression analyses - simple linear regression]

```{r linear-model-1, echo = FALSE}
covid_total <- covid_data %>%
  filter(date == "2021-02-24")

covid_country <- covid_total %>%
  filter(is.na(continent) == FALSE)

covid_other <- covid_total %>%
  filter(is.na(continent) == TRUE)

linear_reg() %>%
  set_engine("lm") %>%
  fit(total_cases_per_million ~ population_density + hospital_beds_per_thousand, data = covid_country) %>%
  tidy()
```

```{r linear-model-2, echo = FALSE}
linear_reg() %>%
  set_engine("lm") %>%
  fit(total_cases_per_million ~ population_density, data = covid_country) %>%
  tidy()
```

---

# Results & Implications - [2a: regression analyses - simple linear regression]

```{r training-test}

```


---

# Results & Implications - [2b: regression analyses - other]




# Results & Implications - [3: machine learnng]

1. linear regression


2. logistic regression


3. KNN (clusters) https://github.com/allisonhorst/stats-illustrations/



---

class: inverse, middle, center

# Limitations and Potential Future Studies

---

# Limitations - details


---

# Future Studies

Future studies

---

# References

[1] Want to find out more about `xaringan`? See https://slides.yihui.name/xaringan/#1.

[2] You are welcomed to use the default styling of the slides. In fact, that's what I expect majority of you will do. You will differentiate yourself with the content of your presentation.

[3]

[4]

---
